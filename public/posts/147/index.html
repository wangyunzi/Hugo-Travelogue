<!DOCTYPE html>
<html lang="zh-cn">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1314&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>docker代理问题</title>
  
  <meta name="description" content="最近自己的docker总是抽风出现各种各样的问题，因为事情过于忙碌来不及处理，一些安装的项目秉持能用则用的心态便拖到如今。昨天升级自己的docker项目出现镜像错误问题，自己的镜像都是到处去网上找的，刚开始能用就没换掉，在google了一堆解决方法之后均无果，于是虚心请教杜老师，杜老师很爽快的给出了他的一篇教程，其实我看过这篇教程，但是因为自己下意识的觉得代理这一块对于我比较陌生，所以就没在意，今天按照教程做了之后立马成功，实在感谢杜老师。因为自己在操作的过程中还是有些微不同，所以还是选择复盘一下，这样也才能加深自己的印象，真正选择实操可以选择去看杜老师的这篇借助 CF 解决 Docker 镜像拉取问题。
bug再现 &amp;emsp;&amp;emsp;首先需要自己注册一个域名，其实我最开始拥有好几个域名，但是自己管理问题导致只剩下一个重要域名，注册新域名的时候竟然发现自己`wangyunzi.xyz`域名处于待售状态，说实话我都不知道这个域名是在哪一个平台上购买的了，我只记得好久没用了，应该没什么大问题，这次为了谨慎起见也是为了方便管理和续费，选择统一在阿里云上注册一个域名，希望大家都能统一注册管理自己的域名吧。 将域名的DNS改成cloudfare，因为我的主域名也是在cloudfare，这样比较方便管理。点击进入新注册的域名，接着点击左侧的workers路由，继续点击管理workers，最后创建。 创建后修改名称之后直接点击部署，之后复制需要的代码进去覆盖掉，然后记得修改第三行的域名成为自己最开始注册的域名。
let hub_host = &amp;#39;registry-1.docker.io&amp;#39; const auth_url = &amp;#39;https://auth.docker.io&amp;#39; let workers_url = &amp;#39;https://docker.birdteam.net&amp;#39; let UA = [&amp;#39;netcraft&amp;#39;]; function routeByHosts(host) { const routes = { &amp;#34;quay&amp;#34;: &amp;#34;quay.io&amp;#34;, &amp;#34;gcr&amp;#34;: &amp;#34;gcr.io&amp;#34;, &amp;#34;k8s-gcr&amp;#34;: &amp;#34;k8s.gcr.io&amp;#34;, &amp;#34;k8s&amp;#34;: &amp;#34;registry.k8s.io&amp;#34;, &amp;#34;ghcr&amp;#34;: &amp;#34;ghcr.io&amp;#34;, &amp;#34;cloudsmith&amp;#34;: &amp;#34;docker.cloudsmith.io&amp;#34;, &amp;#34;test&amp;#34;: &amp;#34;registry-1.docker.io&amp;#34;, }; if (host in routes) return [ routes[host], false ]; else return [ hub_host, true ]; } const PREFLIGHT_INIT = { headers: new Headers({ &amp;#39;access-control-allow-origin&amp;#39;: &amp;#39;*&amp;#39;, &amp;#39;access-control-allow-methods&amp;#39;: &amp;#39;GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS&amp;#39;, &amp;#39;access-control-max-age&amp;#39;: &amp;#39;1728000&amp;#39;, }), } function makeRes(body, status = 200, headers = {}) { headers[&amp;#39;access-control-allow-origin&amp;#39;] = &amp;#39;*&amp;#39; return new Response(body, { status, headers }) } function newUrl(urlStr) { try { return new URL(urlStr) } catch (err) { return null } } function isUUID(uuid) { const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i; return uuidRegex.">

  
  
  <link rel="stylesheet" href="https://blog.wangyunzi.com/json/family=Merriweather.css">
  
  <link rel="stylesheet" href="https://blog.wangyunzi.com/json/family=Lato.css">
  
  <link rel="stylesheet" href="https://blog.wangyunzi.com/json/family=Source.css">
  
  <link rel="stylesheet" href="https://blog.wangyunzi.com/json/fontawesome6.6.min.css">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material&#43;Icons">
  

  <link rel="stylesheet" href="/assets/css/vendors/slidebars.min.css">
  <link rel="stylesheet" href="/assets/css/vendors/rrssb.css">
  <link rel="stylesheet" href="/assets/css/base.css">
  <link rel="stylesheet" href="/assets/css/layout.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/loader.css">
  <link rel="stylesheet" href="/assets/css/sidebar.css">
  <link rel="stylesheet" href="/assets/css/syntax-highlighting.css">

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <link rel="canonical" href="http://localhost:1314/posts/147/">

  <meta property="og:url" content="http://localhost:1314/posts/147/">
  <meta property="og:site_name" content="长街短梦">
  <meta property="og:title" content="docker代理问题">
  <meta property="og:description" content="最近自己的docker总是抽风出现各种各样的问题，因为事情过于忙碌来不及处理，一些安装的项目秉持能用则用的心态便拖到如今。昨天升级自己的docker项目出现镜像错误问题，自己的镜像都是到处去网上找的，刚开始能用就没换掉，在google了一堆解决方法之后均无果，于是虚心请教杜老师，杜老师很爽快的给出了他的一篇教程，其实我看过这篇教程，但是因为自己下意识的觉得代理这一块对于我比较陌生，所以就没在意，今天按照教程做了之后立马成功，实在感谢杜老师。因为自己在操作的过程中还是有些微不同，所以还是选择复盘一下，这样也才能加深自己的印象，真正选择实操可以选择去看杜老师的这篇借助 CF 解决 Docker 镜像拉取问题。
bug再现 &amp;emsp;&amp;emsp;首先需要自己注册一个域名，其实我最开始拥有好几个域名，但是自己管理问题导致只剩下一个重要域名，注册新域名的时候竟然发现自己`wangyunzi.xyz`域名处于待售状态，说实话我都不知道这个域名是在哪一个平台上购买的了，我只记得好久没用了，应该没什么大问题，这次为了谨慎起见也是为了方便管理和续费，选择统一在阿里云上注册一个域名，希望大家都能统一注册管理自己的域名吧。 将域名的DNS改成cloudfare，因为我的主域名也是在cloudfare，这样比较方便管理。点击进入新注册的域名，接着点击左侧的workers路由，继续点击管理workers，最后创建。 创建后修改名称之后直接点击部署，之后复制需要的代码进去覆盖掉，然后记得修改第三行的域名成为自己最开始注册的域名。
let hub_host = &amp;#39;registry-1.docker.io&amp;#39; const auth_url = &amp;#39;https://auth.docker.io&amp;#39; let workers_url = &amp;#39;https://docker.birdteam.net&amp;#39; let UA = [&amp;#39;netcraft&amp;#39;]; function routeByHosts(host) { const routes = { &amp;#34;quay&amp;#34;: &amp;#34;quay.io&amp;#34;, &amp;#34;gcr&amp;#34;: &amp;#34;gcr.io&amp;#34;, &amp;#34;k8s-gcr&amp;#34;: &amp;#34;k8s.gcr.io&amp;#34;, &amp;#34;k8s&amp;#34;: &amp;#34;registry.k8s.io&amp;#34;, &amp;#34;ghcr&amp;#34;: &amp;#34;ghcr.io&amp;#34;, &amp;#34;cloudsmith&amp;#34;: &amp;#34;docker.cloudsmith.io&amp;#34;, &amp;#34;test&amp;#34;: &amp;#34;registry-1.docker.io&amp;#34;, }; if (host in routes) return [ routes[host], false ]; else return [ hub_host, true ]; } const PREFLIGHT_INIT = { headers: new Headers({ &amp;#39;access-control-allow-origin&amp;#39;: &amp;#39;*&amp;#39;, &amp;#39;access-control-allow-methods&amp;#39;: &amp;#39;GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS&amp;#39;, &amp;#39;access-control-max-age&amp;#39;: &amp;#39;1728000&amp;#39;, }), } function makeRes(body, status = 200, headers = {}) { headers[&amp;#39;access-control-allow-origin&amp;#39;] = &amp;#39;*&amp;#39; return new Response(body, { status, headers }) } function newUrl(urlStr) { try { return new URL(urlStr) } catch (err) { return null } } function isUUID(uuid) { const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i; return uuidRegex.">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-25T13:24:47+08:00">
    <meta property="article:modified_time" content="2024-09-25T13:24:47+08:00">
    <meta property="article:tag" content="Docker">

  <meta name="twitter:card" content="summary"><meta name="twitter:title" content="docker代理问题">
<meta name="twitter:description" content="最近自己的docker总是抽风出现各种各样的问题，因为事情过于忙碌来不及处理，一些安装的项目秉持能用则用的心态便拖到如今。昨天升级自己的docker项目出现镜像错误问题，自己的镜像都是到处去网上找的，刚开始能用就没换掉，在google了一堆解决方法之后均无果，于是虚心请教杜老师，杜老师很爽快的给出了他的一篇教程，其实我看过这篇教程，但是因为自己下意识的觉得代理这一块对于我比较陌生，所以就没在意，今天按照教程做了之后立马成功，实在感谢杜老师。因为自己在操作的过程中还是有些微不同，所以还是选择复盘一下，这样也才能加深自己的印象，真正选择实操可以选择去看杜老师的这篇借助 CF 解决 Docker 镜像拉取问题。
bug再现 &emsp;&emsp;首先需要自己注册一个域名，其实我最开始拥有好几个域名，但是自己管理问题导致只剩下一个重要域名，注册新域名的时候竟然发现自己`wangyunzi.xyz`域名处于待售状态，说实话我都不知道这个域名是在哪一个平台上购买的了，我只记得好久没用了，应该没什么大问题，这次为了谨慎起见也是为了方便管理和续费，选择统一在阿里云上注册一个域名，希望大家都能统一注册管理自己的域名吧。 将域名的DNS改成cloudfare，因为我的主域名也是在cloudfare，这样比较方便管理。点击进入新注册的域名，接着点击左侧的workers路由，继续点击管理workers，最后创建。 创建后修改名称之后直接点击部署，之后复制需要的代码进去覆盖掉，然后记得修改第三行的域名成为自己最开始注册的域名。
let hub_host = &#39;registry-1.docker.io&#39; const auth_url = &#39;https://auth.docker.io&#39; let workers_url = &#39;https://docker.birdteam.net&#39; let UA = [&#39;netcraft&#39;]; function routeByHosts(host) { const routes = { &#34;quay&#34;: &#34;quay.io&#34;, &#34;gcr&#34;: &#34;gcr.io&#34;, &#34;k8s-gcr&#34;: &#34;k8s.gcr.io&#34;, &#34;k8s&#34;: &#34;registry.k8s.io&#34;, &#34;ghcr&#34;: &#34;ghcr.io&#34;, &#34;cloudsmith&#34;: &#34;docker.cloudsmith.io&#34;, &#34;test&#34;: &#34;registry-1.docker.io&#34;, }; if (host in routes) return [ routes[host], false ]; else return [ hub_host, true ]; } const PREFLIGHT_INIT = { headers: new Headers({ &#39;access-control-allow-origin&#39;: &#39;*&#39;, &#39;access-control-allow-methods&#39;: &#39;GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS&#39;, &#39;access-control-max-age&#39;: &#39;1728000&#39;, }), } function makeRes(body, status = 200, headers = {}) { headers[&#39;access-control-allow-origin&#39;] = &#39;*&#39; return new Response(body, { status, headers }) } function newUrl(urlStr) { try { return new URL(urlStr) } catch (err) { return null } } function isUUID(uuid) { const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i; return uuidRegex.">

</head>

<body>
  <div class="loader">
  <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">
    <filter id="dropshadow" height="130%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="10"/>
      <feOffset dx="0" dy="0" result="offsetblur"/>
      <feMerge>
        <feMergeNode/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <path d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z">
      <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.5s" repeatCount="indefinite"/>
    </path>
  </svg>
</div>


  <main id="sb-site">
    <div class="container">
      <div class="wrapper">
        
<div class="post">
  
  
  
    
    <p class="post-reading-time">&#126; 5 min</p>
  

  <header class="post-header">
    
    <h1 class="post-title">docker代理问题</h1>
  </header>

  <article class="post-content">
    <p>  最近自己的docker总是抽风出现各种各样的问题，因为事情过于忙碌来不及处理，一些安装的项目秉持能用则用的心态便拖到如今。昨天升级自己的docker项目出现镜像错误问题，自己的镜像都是到处去网上找的，刚开始能用就没换掉，在google了一堆解决方法之后均无果，于是虚心请教杜老师，杜老师很爽快的给出了他的一篇教程，其实我看过这篇教程，但是因为自己下意识的觉得代理这一块对于我比较陌生，所以就没在意，今天按照教程做了之后立马成功，实在感谢杜老师。因为自己在操作的过程中还是有些微不同，所以还是选择复盘一下，这样也才能加深自己的印象，真正选择实操可以选择去看杜老师的这篇<a href="https://dusays.com/727/">借助 CF 解决 Docker 镜像拉取问题</a>。</p>
<center> <img style="border-radius: 0.3125em; box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="https://blog.wangyunzi.com/2024/09/244500.png"> <br> <div style="color:orange; border-bottom: 1px solid #d9d9d9; display: inline-block; color: #999; padding: 2px;">bug再现</div> </center>
&emsp;&emsp;首先需要自己注册一个域名，其实我最开始拥有好几个域名，但是自己管理问题导致只剩下一个重要域名，注册新域名的时候竟然发现自己`wangyunzi.xyz`域名处于待售状态，说实话我都不知道这个域名是在哪一个平台上购买的了，我只记得好久没用了，应该没什么大问题，这次为了谨慎起见也是为了方便管理和续费，选择统一在阿里云上注册一个域名，希望大家都能统一注册管理自己的域名吧。
<p>  将域名的DNS改成cloudfare，因为我的主域名也是在cloudfare，这样比较方便管理。点击进入新注册的域名，接着点击左侧的<code>workers路由</code>，继续点击<code>管理workers</code>，最后创建。
<img src="https://blog.wangyunzi.com/2024/09/254630.png" alt="" loading="lazy"></p>
<p>  创建后修改名称之后直接点击部署，之后复制需要的代码进去覆盖掉，然后记得修改第三行的域名成为自己最开始注册的域名。</p>
<pre tabindex="0"><code>let hub_host = &#39;registry-1.docker.io&#39;
const auth_url = &#39;https://auth.docker.io&#39;
let workers_url = &#39;https://docker.birdteam.net&#39;
let UA = [&#39;netcraft&#39;];
function routeByHosts(host) {
	const routes = {
		&#34;quay&#34;: &#34;quay.io&#34;,
		&#34;gcr&#34;: &#34;gcr.io&#34;,
		&#34;k8s-gcr&#34;: &#34;k8s.gcr.io&#34;,
		&#34;k8s&#34;: &#34;registry.k8s.io&#34;,
		&#34;ghcr&#34;: &#34;ghcr.io&#34;,
		&#34;cloudsmith&#34;: &#34;docker.cloudsmith.io&#34;,
		&#34;test&#34;: &#34;registry-1.docker.io&#34;,
	};
	if (host in routes) return [ routes[host], false ];
	else return [ hub_host, true ];
}
const PREFLIGHT_INIT = {
	headers: new Headers({
		&#39;access-control-allow-origin&#39;: &#39;*&#39;,
		&#39;access-control-allow-methods&#39;: &#39;GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS&#39;,
		&#39;access-control-max-age&#39;: &#39;1728000&#39;,
	}),
}
function makeRes(body, status = 200, headers = {}) {
	headers[&#39;access-control-allow-origin&#39;] = &#39;*&#39;
	return new Response(body, { status, headers })
}
function newUrl(urlStr) {
	try {
		return new URL(urlStr)
	} catch (err) {
		return null
	}
}
function isUUID(uuid) {
	const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
	return uuidRegex.test(uuid);
}
async function nginx() {
	const text = `
	&lt;!DOCTYPE html&gt;
	&lt;html&gt;
	&lt;head&gt;
	&lt;title&gt;Welcome to nginx!&lt;/title&gt;
	&lt;style&gt;
		body {
			width: 35em;
			margin: 0 auto;
			font-family: Tahoma, Verdana, Arial, sans-serif;
		}
	&lt;/style&gt;
	&lt;/head&gt;
	&lt;body&gt;
	&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
	&lt;p&gt;If you see this page, the nginx web server is successfully installed and
	working. Further configuration is required.&lt;/p&gt;
	&lt;p&gt;For online documentation and support please refer to
	&lt;a href=&#34;http://nginx.org/&#34;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
	Commercial support is available at
	&lt;a href=&#34;http://nginx.com/&#34;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
	&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
	&lt;/body&gt;
	&lt;/html&gt;
	`
	return text ;
}
export default {
	async fetch(request, env, ctx) {
		const getReqHeader = (key) =&gt; request.headers.get(key);
		let url = new URL(request.url);
		const userAgentHeader = request.headers.get(&#39;User-Agent&#39;);
		const userAgent = userAgentHeader ? userAgentHeader.toLowerCase() : &#34;null&#34;;
		if (env.UA) UA = UA.concat(await ADD(env.UA));
		workers_url = `https://${url.hostname}`;
		const pathname = url.pathname;
		const hostname = url.searchParams.get(&#39;hubhost&#39;) || url.hostname; 
		const hostTop = hostname.split(&#39;.&#39;)[0];
		const checkHost = routeByHosts(hostTop);
		hub_host = checkHost[0];
		const fakePage = checkHost[1];
		console.log(`域名头部: ${hostTop}\n反代地址: ${hub_host}\n伪装首页: ${fakePage}`);
		const isUuid = isUUID(pathname.split(&#39;/&#39;)[1].split(&#39;/&#39;)[0]);
		if (UA.some(fxxk =&gt; userAgent.includes(fxxk)) &amp;&amp; UA.length &gt; 0){
			return new Response(await nginx(), {
				headers: {
					&#39;Content-Type&#39;: &#39;text/html; charset=UTF-8&#39;,
				},
			});
		}
		const conditions = [
			isUuid,
			pathname.includes(&#39;/_&#39;),
			pathname.includes(&#39;/r&#39;),
			pathname.includes(&#39;/v2/user&#39;),
			pathname.includes(&#39;/v2/orgs&#39;),
			pathname.includes(&#39;/v2/_catalog&#39;),
			pathname.includes(&#39;/v2/categories&#39;),
			pathname.includes(&#39;/v2/feature-flags&#39;),
			pathname.includes(&#39;search&#39;),
			pathname.includes(&#39;source&#39;),
			pathname === &#39;/&#39;,
			pathname === &#39;/favicon.ico&#39;,
			pathname === &#39;/auth/profile&#39;,
		];
		if (conditions.some(condition =&gt; condition) &amp;&amp; (fakePage === true || hostTop == &#39;docker&#39;)) {
			if (env.URL302){
				return Response.redirect(env.URL302, 302);
			} else if (env.URL){
				if (env.URL.toLowerCase() == &#39;nginx&#39;){
					return new Response(await nginx(), {
						headers: {
							&#39;Content-Type&#39;: &#39;text/html; charset=UTF-8&#39;,
						},
					});
				} else return fetch(new Request(env.URL, request));
			}
			const newUrl = new URL(&#34;https://registry.hub.docker.com&#34; + pathname + url.search);
			const headers = new Headers(request.headers);
			headers.set(&#39;Host&#39;, &#39;registry.hub.docker.com&#39;);
			const newRequest = new Request(newUrl, {
					method: request.method,
					headers: headers,
					body: request.method !== &#39;GET&#39; &amp;&amp; request.method !== &#39;HEAD&#39; ? await request.blob() : null,
					redirect: &#39;follow&#39;
			});
			return fetch(newRequest);
		}
		if (!/%2F/.test(url.search) &amp;&amp; /%3A/.test(url.toString())) {
			let modifiedUrl = url.toString().replace(/%3A(?=.*?&amp;)/, &#39;%3Alibrary%2F&#39;);
			url = new URL(modifiedUrl);
			console.log(`handle_url: ${url}`)
		}
		if (url.pathname.includes(&#39;/token&#39;)) {
			let token_parameter = {
				headers: {
					&#39;Host&#39;: &#39;auth.docker.io&#39;,
					&#39;User-Agent&#39;: getReqHeader(&#34;User-Agent&#34;),
					&#39;Accept&#39;: getReqHeader(&#34;Accept&#34;),
					&#39;Accept-Language&#39;: getReqHeader(&#34;Accept-Language&#34;),
					&#39;Accept-Encoding&#39;: getReqHeader(&#34;Accept-Encoding&#34;),
					&#39;Connection&#39;: &#39;keep-alive&#39;,
					&#39;Cache-Control&#39;: &#39;max-age=0&#39;
				}
			};
			let token_url = auth_url + url.pathname + url.search
			return fetch(new Request(token_url, request), token_parameter)
		}
		if (/^\/v2\/[^/]+\/[^/]+\/[^/]+$/.test(url.pathname) &amp;&amp; !/^\/v2\/library/.test(url.pathname)) {
			url.pathname = url.pathname.replace(/\/v2\//, &#39;/v2/library/&#39;);
			console.log(`modified_url: ${url.pathname}`)
		}
		url.hostname = hub_host;
		let parameter = {
			headers: {
				&#39;Host&#39;: hub_host,
				&#39;User-Agent&#39;: getReqHeader(&#34;User-Agent&#34;),
				&#39;Accept&#39;: getReqHeader(&#34;Accept&#34;),
				&#39;Accept-Language&#39;: getReqHeader(&#34;Accept-Language&#34;),
				&#39;Accept-Encoding&#39;: getReqHeader(&#34;Accept-Encoding&#34;),
				&#39;Connection&#39;: &#39;keep-alive&#39;,
				&#39;Cache-Control&#39;: &#39;max-age=0&#39;
			},
			cacheTtl: 3600
		};
		if (request.headers.has(&#34;Authorization&#34;)) {
			parameter.headers.Authorization = getReqHeader(&#34;Authorization&#34;);
		}
		let original_response = await fetch(new Request(url, request), parameter)
		let original_response_clone = original_response.clone();
		let original_text = original_response_clone.body;
		let response_headers = original_response.headers;
		let new_response_headers = new Headers(response_headers);
		let status = original_response.status;
		if (new_response_headers.get(&#34;Www-Authenticate&#34;)) {
			let auth = new_response_headers.get(&#34;Www-Authenticate&#34;);
			let re = new RegExp(auth_url, &#39;g&#39;);
			new_response_headers.set(&#34;Www-Authenticate&#34;, response_headers.get(&#34;Www-Authenticate&#34;).replace(re, workers_url));
		}
		if (new_response_headers.get(&#34;Location&#34;)) {
			return httpHandler(request, new_response_headers.get(&#34;Location&#34;))
		}
		let response = new Response(original_text, {
			status,
			headers: new_response_headers
		})
		return response;
	}
};
function httpHandler(req, pathname) {
	const reqHdrRaw = req.headers
	if (req.method === &#39;OPTIONS&#39; &amp;&amp;
		reqHdrRaw.has(&#39;access-control-request-headers&#39;)
	) {
		return new Response(null, PREFLIGHT_INIT)
	}
	let rawLen = &#39;&#39;
	const reqHdrNew = new Headers(reqHdrRaw)
	const refer = reqHdrNew.get(&#39;referer&#39;)
	let urlStr = pathname
	const urlObj = newUrl(urlStr)
	const reqInit = {
		method: req.method,
		headers: reqHdrNew,
		redirect: &#39;follow&#39;,
		body: req.body
	}
	return proxy(urlObj, reqInit, rawLen)
}
async function proxy(urlObj, reqInit, rawLen) {
	const res = await fetch(urlObj.href, reqInit)
	const resHdrOld = res.headers
	const resHdrNew = new Headers(resHdrOld)
	if (rawLen) {
		const newLen = resHdrOld.get(&#39;content-length&#39;) || &#39;&#39;
		const badLen = (rawLen !== newLen)
		if (badLen) {
			return makeRes(res.body, 400, {
				&#39;--error&#39;: `bad len: ${newLen}, except: ${rawLen}`,
				&#39;access-control-expose-headers&#39;: &#39;--error&#39;,
			})
		}
	}
	const status = res.status
	resHdrNew.set(&#39;access-control-expose-headers&#39;, &#39;*&#39;)
	resHdrNew.set(&#39;access-control-allow-origin&#39;, &#39;*&#39;)
	resHdrNew.set(&#39;Cache-Control&#39;, &#39;max-age=1500&#39;)
	resHdrNew.delete(&#39;content-security-policy&#39;)
	resHdrNew.delete(&#39;content-security-policy-report-only&#39;)
	resHdrNew.delete(&#39;clear-site-data&#39;)
	return new Response(res.body, {
		status,
		headers: resHdrNew
	})
}
async function ADD(envadd) {
	var addtext = envadd.replace(/[	 |&#34;&#39;\r\n]+/g, &#39;,&#39;).replace(/,+/g, &#39;,&#39;);
	//console.log(addtext);
	if (addtext.charAt(0) == &#39;,&#39;) addtext = addtext.slice(1);
	if (addtext.charAt(addtext.length -1) == &#39;,&#39;) addtext = addtext.slice(0, addtext.length - 1);
	const add = addtext.split(&#39;,&#39;);
	//console.log(add);
	return add ;
}
</code></pre><p>  最后按照杜老师评论区首评的做法就是如下图所示：
<img src="https://blog.wangyunzi.com/2024/09/255507.png" alt="" loading="lazy"></p>
<p>  将自己的镜像添加到docker中，打开<code>根目录/etc/docker/daemon.json</code>文件，修改成下面：</p>
<pre tabindex="0"><code>{
    &#34;registry-mirrors&#34;: [
        &#34;https://wangyunzi.ren&#34;
    ]
}
</code></pre><p>  至此，docker pull圆满成功，再次感谢杜老师的教程！</p>

  </article>

  <footer class="post-meta">
    
    <div class="meta">
      <h3 class="meta-title">Date</h3>
      <span class="meta-content">September 25, 2024</span>
    </div>
    

    
    
    

    
    
    
      
      <div class="meta">
        <h3 class="meta-title">Categories</h3>
        <span class="meta-content">
      
            博客&nbsp;
          
        </span>
      </div>
      
    

    
    
    
      
      <div class="meta">
        <h3 class="meta-title">Tags</h3>
        <span class="meta-content">
      
            Docker&nbsp;
          
        </span>
      </div>
      
    
  </footer>

  
  
  
  
  
  
  
  
  
  <div class="post-share">
    <ul class="rrssb-buttons tiny-format clearfix">
      
      <li class="rrssb-facebook">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http%253A%252F%252Flocalhost%253A1314%252Fposts%252F147%252F" title="Facebook" class="popup">
          <span class="rrssb-icon">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
              <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
              c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
              c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"/>
            </svg>
          </span>
          <span class="rrssb-text">Post</span>
        </a>
      </li>
      

      
      <li class="rrssb-twitter">
        <a href="https://twitter.com/intent/tweet?url=http%253A%252F%252Flocalhost%253A1314%252Fposts%252F147%252F&amp;text=docker%25E4%25BB%25A3%25E7%2590%2586%25E9%2597%25AE%25E9%25A2%2598" title="Twitter" class="popup">
          <span class="rrssb-icon">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
              <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
              c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
              C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
              C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
              c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
              C26.275,7.229,25.39,8.196,24.253,8.756z"/>
            </svg>
          </span>
          <span class="rrssb-text">Tweet</span>
        </a>
      </li>
      

      

      

      
      <li class="rrssb-reddit">
        <a href="https://www.reddit.com/submit?url=http%253A%252F%252Flocalhost%253A1314%252Fposts%252F147%252F&amp;title=docker%25E4%25BB%25A3%25E7%2590%2586%25E9%2597%25AE%25E9%25A2%2598" title="Reddit" class="popup">
          <span class="rrssb-icon">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g><path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"/><path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"/><path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 19.5 17.8 19.5 17.5 19.791z"/><path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 C26.354 13.8 26.1 14.3 25.8 14.605z"/></g></svg>
          </span>
          <span class="rrssb-text">Submit</span>
        </a>
      </li>
      

      

      

      

      

      
      <li class="rrssb-email">
        <a href="mailto:?subject=docker%25E4%25BB%25A3%25E7%2590%2586%25E9%2597%25AE%25E9%25A2%2598&amp;body=http%253A%252F%252Flocalhost%253A1314%252Fposts%252F147%252F" title="Email">
          <span class="rrssb-icon">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g><path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z"/></g></svg>
          </span>
          <span class="rrssb-text">Send</span>
        </a>
      </li>
      
    </ul>
  </div>


  


















  
  
  
  
    
    
  
  
    
    
    
    
    
    
    
      
      
      
    
  
  
    
    
    
  




















  

<div id="tcomment"></div>

<style>
 
.twikoo {
    overflow: visible !important;
    font-family: "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
}

.tk-extras,
.tk-row.actions .tk-action-icon.__markdown,
.tk-preview,
.tk-content p a.at,
.tk-tag.tk-tag-green {
    display: none !important;
}

 
.tk-content {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    margin-top: 0 !important;
}

.tk-content-expand {
  max-height: none;
}
.tk-replies .tk-content {
  font-size: .9em;
  display: flex;
  align-items: baseline;  
  color: #292a2d !important;
}

.tk-content span:first-child {
    display: inline-block;
    margin-right: 1em;  
}

.tk-content p {
    margin: 0;
    text-align: left;
    flex: 1 1 auto;
}

.tk-content p a.at {
    margin-left: 0 !important;
}

.tk-nick-link {
    color: #252627 !important;
}

.tk-ruser {
    color: black;
    text-decoration: none;  
}

.tk-replies {
    display: flex;
    flex-direction: column;
}

.tk-comment {
    margin-top: 17px !important;
}

.tk-comments-container .tk-avatar {
    margin-top: 10px;
}

 
.tk-avatar img {
    width: 50px;  
    height: 50px;  
    border-radius: 0;  
    border: 2px solid #ddd;  
}

.tk-expand {
    border-radius: 0 0 5px 5px;
    position: relative;
    z-index: 99;
    margin-top: -10px;
    padding: 0 !important;
    color: #292a2d !important;
}

.el-button.tk-preview {
    border: none;
}

.el-input.is-active .el-input__inner,
.el-input__inner:focus,
.el-textarea__inner {
    border-color: #ccc !important;
}

.el-button--primary.is-disabled,
.el-button--primary.is-disabled:active,
.el-button--primary.is-disabled:focus,
.el-button--primary.is-disabled:hover {
    color: #FFF !important;
    background-color: #252627 !important;
    border-color: #4a4b50 !important;
}

.tk-action-icon svg {
    fill: #434a56 !important;
}

.tk-comments-title .tk-icon svg {
    fill: #ccc !important;
}

.tk-action-count {
    color: #434a56 !important;
}

.el-loading-mask {
    background-color: #fff !important;
}

.dark .el-loading-mask {
    background-color: #292a2d !important;
}

.dark .tk-expand {
    background: linear-gradient(rgba(38,42,56,0), #3b3d42) !important;
}

.dark .el-button,
.dark .el-input__inner,
.dark .el-textarea__inner {
    color: silver !important;
    background-color: #252627 !important;
    border-color: #4a4b50 !important;
}

.dark .tk-meta-input .el-input .el-input-group__prepend {
    color: silver !important;
    background-color: #4a4b50 !important;
    border-color: #4a4b50 !important;
}

.dark .el-button--primary.is-disabled,
.dark .el-button--primary.is-disabled:active,
.dark .el-button--primary.is-disabled:focus,
.dark .el-button--primary.is-disabled:hover {
    color: #FFF !important;
    background-color: #252627 !important;
    border-color: #4a4b50 !important;
}

.dark .tk-action-icon svg {
    fill: #ccc !important;
}

.dark .tk-comments-title .tk-icon svg {
    fill: #4a4b50 !important;
}

.dark .tk-action-count {
    color: #ccc !important;
}

.OwO .OwO-body {
    z-index: 99;
}

.OwO .OwO-body .OwO-items-emoji .OwO-item {
    font-size: 23px !important;
}

.OwO .OwO-body .OwO-items-image .OwO-item {
    max-width: calc(20% - 10px) !important;
}

.dark .OwO-body {
    color: silver !important;
    background-color: #252627 !important;
    border-color: #4a4b50 !important;
}

.dark .OwO .OwO-body .OwO-bar {
    border-top: 1px solid #4a4b50 !important;
}

.dark .OwO .OwO-body .OwO-items .OwO-item,
.dark .OwO .OwO-body .OwO-bar {
    background: #4a4b50 !important;
    color: #ccc !important;
}

.dark .OwO .OwO-body .OwO-bar .OwO-packages li:hover,
.dark .OwO .OwO-body .OwO-items-image .OwO-item:hover,
.dark .OwO .OwO-body .OwO-bar .OwO-packages .OwO-package-active {
    background-color: #252627 !important;
}

</style>

<script src="https://blog.wangyunzi.com/json/twikoo.all.min.js"></script>
<script>
twikoo.init({
  envId: 'https:\/\/twikoo.wangyunzi.com\/', 
  el: '#tcomment', 



})
</script>
</br>

  


</div>

      </div>
      
  
  
  
  
    
    
      
    
  
  <div class="next-post">
    <a href="/posts/148/" class="next-post-link"></a>
    <img src="https://blog.wangyunzi.com/config/cover/woman.webp" class="next-post-thumb" alt="Next post thumbnail">
    <div class="next-post-info">
      <span class="next-story">Next Story</span>
      <h3 class="next-post-title">Claude注册即被封</h3>
    </div>
  </div>



    </div>
  </main>

  <a href="#" class="sb-toggle-left">Menu
  <span class="nav-icon"></span>
</a>

<div class="sb-slidebar sb-left sb-style-push">
  <nav>
    <a href="/"><h2 class="site-title">长街短梦</h2></a>
    <ul class="sb-menu">
      
      
        <li class="sb-close ">
          <a href="/archive/">时间线</a>
        </li>
      
        <li class="sb-close ">
          <a href="/links/">链圈</a>
        </li>
      
        <li class="sb-close ">
          <a href="/friend/">友链</a>
        </li>
      
        <li class="sb-close ">
          <a href="/about/">关于</a>
        </li>
      
    </ul>

    <div class="site-info">
      <p>
        长街短梦 &dash; Copyright &copy; 2026
      </p>
      
      <p class="site-footer-links">
        <a href="/memos/">瞬间</a> · <a href="/album/">相册</a>
      </p>
      
      <p>
        Powered by Hugo
      </p>
      
      
      <p>
        <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备2022025879号</a>&nbsp;
      </p>
      
      
    </div>
  </nav>
</div>

  <script type="text/javascript" src="/assets/js/libs/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/libs/slidebars.min.js"></script>
<script type="text/javascript" src="/assets/js/libs/jquery.backstretch.min.js"></script>
<script type="text/javascript" src="/assets/js/libs/jquery.scrollstop.js"></script>
<script type="text/javascript" src="/assets/js/libs/rrssb.min.js"></script>
<script type="text/javascript" src="/assets/js/functions.js"></script>







<script src="https://blog.wangyunzi.com/json/lazysizes.min.js" async></script>

<script type="text/javascript">
  $(function($) {
    $.slidebars();

    var steps = [];
    var images = [
      
      
    ];

    if (images.length > 0) {
      $('.loader').addClass('loading');

      steps = scrollSteps(images.length);

      $.backstretch(images, {
        fade: 1000
      });

      $.backstretch('pause');
    }

    $(document).on("backstretch.before", function (e, instance, index) {
      $('.loader').addClass('loading');
    });

    $(document).on('scrollstop', function () {
      if (steps.length > 0) {
        var percentage = scrollPercentage();

        for (var i = 0; i < steps.length; i++) {
          if (percentage < steps[i]) {
            if (i == $("body").data("backstretch").index) {
              break;
            }

            $.backstretch('show', i);
            break;
          }
        }
      }
    });

    $(document).on("backstretch.after", function (e, instance, index) {
      $('.loader').removeClass('loading');
    });
  });
</script>






  
    
    
    
    
  




<script src="https://blog.wangyunzi.com/json/medium-zoom.min.js"></script>

<script type="text/javascript">
  mediumZoom('img', {
    margin:  24 
  });
</script>

<style>
  .medium-zoom-overlay {
    background: transparent !important;
  }
  .medium-zoom-image {
    z-index: 9999;
  }
</style>





  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-RG3B8PERQE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RG3B8PERQE');
</script>





  
  


<script type="text/javascript" src="//js.users.51.la/21897449.js"></script>





  
  


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?78820c974c73efd2bb12a472c22119d7";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




  


<script async src="https://cdn.splitbee.io/sb.js"></script>







  
    
    
    
    
  




<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>
  addBackToTop({
    diameter:  45 ,
    backgroundColor: 'black',
    textColor: '#FFFFF0'
  })
</script>





<script>
  document.addEventListener("DOMContentLoaded", function () {
    var links = document.querySelectorAll('article a');
    links.forEach(function (link) {
      link.setAttribute('target', '_blank');
    });
  });
</script>


</body>
</html>
